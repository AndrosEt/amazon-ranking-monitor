(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a54513f"],{"231c":function(e,t,n){"use strict";n("effc")},"57da":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"asin-container"},[n("div",{staticClass:"header-container"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleAdd()}}},[e._v("新增asin ")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.asinTableLoading,expression:"asinTableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.asinList}},[n("el-table-column",{attrs:{prop:"asin",label:"asin",width:"180"}}),n("el-table-column",{attrs:{prop:"count",label:"关键词个数",width:"180"}}),n("el-table-column",{attrs:{label:"关键词",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"keyword-wrapper",attrs:{slot:"reference"},slot:"reference"},e._l(t.row.keywords,(function(r,i){return n("el-tag",{key:r.keyword,staticStyle:{"margin-right":"3px",cursor:"pointer"},attrs:{size:"medium"},on:{click:function(n){return e.handleKeywordRanking(t.$index,i)}}},[e._v(e._s(r.keyword)+e._s(r.ranking.length>0?":"+r.ranking[r.ranking.length-1].page+"-"+r.ranking[r.ranking.length-1].index:""))])})),1)]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑 ")])]}}])})],1),n("el-dialog",{attrs:{title:"提示",visible:e.asinDialogVisible,width:"80%"},on:{"update:visible":function(t){e.asinDialogVisible=t}}},[n("el-form",{ref:"asinDetailForm",staticClass:"demo-dynamic",attrs:{model:e.asinDetailForm,"label-width":"100px"}},[n("el-form-item",{attrs:{prop:"asin",label:"asin",rules:{required:!0,message:"asin不能为空",trigger:"blur"}}},[n("el-input",{attrs:{disabled:void 0!==e.selectEditAsinIndex},model:{value:e.asinDetailForm.asin,callback:function(t){e.$set(e.asinDetailForm,"asin",t)},expression:"asinDetailForm.asin"}})],1),e._l(e.asinDetailForm.keywords,(function(t,r){return n("el-form-item",{key:r,attrs:{label:"关键词"+(r+1),rules:{required:!0,message:"关键词不能为空",trigger:"blur"}}},[n("el-input",{model:{value:t.keyword,callback:function(n){e.$set(t,"keyword",n)},expression:"keyword.keyword"}}),n("el-button",{on:{click:function(t){return t.preventDefault(),e.removeKeyword(r)}}},[e._v("删除")])],1)})),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitAsinForm("asinDetailForm")}}},[e._v("提交")]),n("el-button",{on:{click:e.addKeyword}},[e._v("新增keyword")])],1)],2),void 0!==e.selectEditAsinIndex?n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"danger"},on:{click:e.handleDeleteAsin}},[e._v("删除此 Asin")])],1):e._e()],1)],1)},i=[],a=n("2909"),s=n("5530"),o=n("1da1"),c=(n("a434"),n("d3b7"),n("159b"),n("c740"),n("d81d"),n("a9e3"),n("b680"),n("96cf"),n("d697")),d=n("e700"),l=n.n(d),u={name:"Home",props:{msg:String},data:function(){return{asinList:[],asinTableLoading:!1,asinDialogVisible:!1,asinDetailForm:{asin:"",keywords:[]},INIT_OPTIONS:{bulk:!0,number:c["defaultItemLimit"],filetype:"",rating:[1,5],page:1,cookie:"",asyncTasks:10,sponsored:!1,category:"aps",cli:!1,sort:!1,discount:!1,reviewFilter:{sortBy:"recent",verifiedPurchaseOnly:!1,filterByStar:"",formatType:"all_formats"}},selectEditAsinIndex:void 0,selectEditAsin:void 0}},created:function(){this.getAsinFromDb(),this.startTask()},mounted:function(){setInterval(this.getAsinFromDb,6e4)},methods:{handleView:function(e,t){this.$router.push({path:"keyword",query:{asinIndex:e}})},handleAdd:function(){this.asinDialogVisible=!0},handleDeleteAsin:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("此操作将永久删除历史, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$dbOperation.dbOperation("delete",{},e.dbKeyList[e.selectEditAsinIndex]);case 2:return e.$message({type:"success",message:"删除成功!"}),e.asinDialogVisible=!1,e.resetAsinForm("asinDetailForm"),t.next=7,e.getAsinFromDb();case 7:case"end":return t.stop()}}),t)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}));case 1:case"end":return t.stop()}}),t)})))()},removeKeyword:function(e){this.asinDetailForm.keywords.splice(e,1)},submitAsinForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(n){var r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=23;break}if(void 0===t.selectEditAsinIndex){e.next=13;break}return r=[],t.selectEditAsin.keywords.forEach((function(e){t.asinDetailForm.keywords.findIndex((function(t){return t.keyword===e.keyword}))>-1&&r.push(e)})),t.asinDetailForm.keywords.forEach((function(e){-1===r.findIndex((function(t){return t.keyword===e.keyword}))&&r.push({keyword:e.keyword,ranking:[]})})),i={asin:t.asinDetailForm.asin,keywords:r},e.next=8,t.$dbOperation.dbOperation("put",i,t.dbKeyList[t.selectEditAsinIndex]);case 8:t.$message.success("修改成功！"),t.resetAsinForm("asinDetailForm"),t.selectEditAsinIndex=void 0,e.next=18;break;case 13:return a={asin:t.asinDetailForm.asin,keywords:t.asinDetailForm.keywords.map((function(e){return{keyword:e.keyword,ranking:[]}}))},e.next=16,t.$dbOperation.dbOperation("add",a);case 16:t.$message.success("添加成功！"),t.resetAsinForm("asinDetailForm");case 18:return t.asinDialogVisible=!1,e.next=21,t.getAsinFromDb();case 21:e.next=25;break;case 23:return t.$message.error("填写内容有错误！"),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},addKeyword:function(){this.asinDetailForm.keywords.push({keyword:"",ranking:[]})},resetAsinForm:function(e){this.$refs[e].resetFields()},handleKeywordRanking:function(e,t){this.$router.push({path:"keyword",query:{asinIndex:e,keywordIndex:t}})},handleEdit:function(e,t){this.asinDialogVisible=!0,this.selectEditAsin=t,this.asinDetailForm=t,this.selectEditAsinIndex=e},getAsinFromDb:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$dbOperation.dbOperation("getAll");case 2:return e.dbDataList=t.sent,t.next=5,e.$dbOperation.dbOperation("getAllKeys");case 5:e.dbKeyList=t.sent,e.asinList=e.dbDataList.map((function(e){return{asin:e.asin,count:e.keywords.length,keywords:e.keywords}}));case 7:case"end":return t.stop()}}),t)})))()},startTask:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:setInterval(e.listLoop,3e5);case 1:case"end":return t.stop()}}),t)})))()},listLoop:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$dbOperation.dbOperation("getAll");case 2:return e.dbDataList=t.sent,t.next=5,e.$dbOperation.dbOperation("getAllKeys");case 5:e.dbKeyList=t.sent,n=0;case 7:if(!(n<e.dbDataList.length)){t.next=20;break}r=e.dbDataList[n],i=e.dbDataList[n].keywords,a=0;case 11:if(!(a<i.length)){t.next=17;break}return t.next=14,e.checkRanking(r,n,a);case 14:a++,t.next=11;break;case 17:n++,t.next=7;break;case 20:case"end":return t.stop()}}),t)})))()},checkRanking:function(e,t,n){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var d,u,f,m;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return d=Object(s["a"])({},r.INIT_OPTIONS),d.geo=c["geo"]["US"],d.scrapeType="ranking",d.asyncPage=5,d.bulk=!0,d.asin=e.asin,d.keyword=e.keywords[n].keyword,i.next=9,new l.a(d);case 9:return u=i.sent,i.next=12,u.startScraper();case 12:f=i.sent,m=r,setTimeout((function(){m.$nextTick(Object(o["a"])(regeneratorRuntime.mark((function r(){var i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(f.result.length>0)){r.next=5;break}return s=f.result.map((function(e){return{page:e.page,index:e.index,type:e.isAd?"ad":"normal",time:Number(((new Date).getTime()/1e3).toFixed(0))}})),(i=e.keywords[n].ranking).push.apply(i,Object(a["a"])(s)),r.next=5,m.$dbOperation.dbOperation("put",e,m.dbKeyList[t]);case 5:case"end":return r.stop()}}),r)}))))}),1e3);case 15:case"end":return i.stop()}}),i)})))()}}},f=u,m=(n("231c"),n("2877")),p=Object(m["a"])(f,r,i,!1,null,"0210e9ec",null);t["default"]=p.exports},a434:function(e,t,n){"use strict";var r=n("23e7"),i=n("da84"),a=n("23cb"),s=n("5926"),o=n("07fa"),c=n("7b0b"),d=n("65f0"),l=n("8418"),u=n("1dde"),f=u("splice"),m=i.TypeError,p=Math.max,b=Math.min,g=9007199254740991,k="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!f},{splice:function(e,t){var n,r,i,u,f,w,h=c(this),y=o(h),x=a(e,y),v=arguments.length;if(0===v?n=r=0:1===v?(n=0,r=y-x):(n=v-2,r=b(p(s(t),0),y-x)),y+n-r>g)throw m(k);for(i=d(h,r),u=0;u<r;u++)f=x+u,f in h&&l(i,u,h[f]);if(i.length=r,n<r){for(u=x;u<y-r;u++)f=u+r,w=u+n,f in h?h[w]=h[f]:delete h[w];for(u=y;u>y-r+n;u--)delete h[u-1]}else if(n>r)for(u=y-r;u>x;u--)f=u+r-1,w=u+n-1,f in h?h[w]=h[f]:delete h[w];for(u=0;u<n;u++)h[u+x]=arguments[u+2];return h.length=y-r+n,i}})},c740:function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").findIndex,a=n("44d2"),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),r({target:"Array",proto:!0,forced:o},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a(s)},effc:function(e,t,n){}}]);
//# sourceMappingURL=chunk-4a54513f.3b9f8e17.js.map