{"version":3,"sources":["webpack:///./src/components/Home.vue?344d","webpack:///src/components/Home.vue","webpack:///./src/components/Home.vue?0a59","webpack:///./src/components/Home.vue","webpack:///./node_modules/core-js/modules/es.array.splice.js","webpack:///./src/components/Home.vue?15a1","webpack:///./node_modules/core-js/modules/es.array.find-index.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","handleAdd","_v","directives","name","rawName","value","expression","staticStyle","asinList","scopedSlots","_u","key","fn","scope","slot","_l","row","item","index","keyword","handleKeywordRanking","$index","_s","ranking","length","page","handleEdit","asinDialogVisible","ref","asinDetailForm","required","message","trigger","undefined","selectEditAsinIndex","model","callback","$$v","$set","preventDefault","removeKeyword","submitAsinForm","addKeyword","handleDeleteAsin","_e","staticRenderFns","props","msg","data","asinTableLoading","asin","keywords","INIT_OPTIONS","bulk","number","filetype","rating","cookie","asyncTasks","sponsored","category","cli","sort","discount","reviewFilter","sortBy","verifiedPurchaseOnly","filterByStar","formatType","selectEditAsin","created","getAsinFromDb","startTask","mounted","setInterval","methods","handleView","$router","push","path","query","asinIndex","confirmButtonText","cancelButtonText","type","then","catch","splice","formName","$refs","validate","valid","resetAsinForm","resetFields","keywordIndex","count","listLoop","i","keywordList","j","checkRanking","options","scraper","that","setTimeout","newRanking","time","component","$","global","toAbsoluteIndex","toIntegerOrInfinity","lengthOfArrayLike","toObject","arraySpeciesCreate","createProperty","arrayMethodHasSpeciesSupport","HAS_SPECIES_SUPPORT","TypeError","max","Math","min","MAX_SAFE_INTEGER","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","target","proto","forced","start","deleteCount","insertCount","actualDeleteCount","A","k","from","to","O","len","actualStart","argumentsLength","arguments","$findIndex","findIndex","addToUnscopables","FIND_INDEX","SKIPS_HOLES","Array","callbackfn"],"mappings":"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","file":"js/chunk-58a61788.aceedead.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"asin-container\"},[_c('div',{staticClass:\"header-container\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.handleAdd()}}},[_vm._v(\"新增asin \")])],1),_c('el-table',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.asinTableLoading),expression:\"asinTableLoading\"}],staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.asinList}},[_c('el-table-column',{attrs:{\"prop\":\"asin\",\"label\":\"asin\",\"width\":\"180\"}}),_c('el-table-column',{attrs:{\"prop\":\"count\",\"label\":\"关键词个数\",\"width\":\"180\"}}),_c('el-table-column',{attrs:{\"label\":\"关键词\",\"width\":\"280\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('div',{staticClass:\"keyword-wrapper\",attrs:{\"slot\":\"reference\"},slot:\"reference\"},_vm._l((scope.row.keywords),function(item,index){return _c('el-tag',{key:item.keyword,staticStyle:{\"margin-right\":\"3px\",\"cursor\":\"pointer\"},attrs:{\"size\":\"medium\"},on:{\"click\":function($event){return _vm.handleKeywordRanking(scope.$index, index)}}},[_vm._v(_vm._s(item.keyword)+_vm._s(item.ranking.length > 0? ':' + item.ranking[item.ranking.length - 1].page + '-' + item.ranking[item.ranking.length - 1].index: ''))])}),1)]}}])}),_c('el-table-column',{attrs:{\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){return _vm.handleEdit(scope.$index, scope.row)}}},[_vm._v(\"编辑 \")])]}}])})],1),_c('el-dialog',{attrs:{\"title\":\"提示\",\"visible\":_vm.asinDialogVisible,\"width\":\"80%\"},on:{\"update:visible\":function($event){_vm.asinDialogVisible=$event}}},[_c('el-form',{ref:\"asinDetailForm\",staticClass:\"demo-dynamic\",attrs:{\"model\":_vm.asinDetailForm,\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"prop\":\"asin\",\"label\":\"asin\",\"rules\":{\n            required: true, message: 'asin不能为空', trigger: 'blur'\n          }}},[_c('el-input',{attrs:{\"disabled\":_vm.selectEditAsinIndex !== undefined},model:{value:(_vm.asinDetailForm.asin),callback:function ($$v) {_vm.$set(_vm.asinDetailForm, \"asin\", $$v)},expression:\"asinDetailForm.asin\"}})],1),_vm._l((_vm.asinDetailForm.keywords),function(keyword,index){return _c('el-form-item',{key:index,attrs:{\"label\":'关键词' + (index + 1),\"rules\":{\n            required: true, message: '关键词不能为空', trigger: 'blur'\n          }}},[_c('el-input',{model:{value:(keyword.keyword),callback:function ($$v) {_vm.$set(keyword, \"keyword\", $$v)},expression:\"keyword.keyword\"}}),_c('el-button',{on:{\"click\":function($event){$event.preventDefault();return _vm.removeKeyword(index)}}},[_vm._v(\"删除\")])],1)}),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.submitAsinForm('asinDetailForm')}}},[_vm._v(\"提交\")]),_c('el-button',{on:{\"click\":_vm.addKeyword}},[_vm._v(\"新增keyword\")])],1)],2),(_vm.selectEditAsinIndex !== undefined)?_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{attrs:{\"type\":\"danger\"},on:{\"click\":_vm.handleDeleteAsin}},[_vm._v(\"删除此 Asin\")])],1):_vm._e()],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"asin-container\">\n    <div class=\"header-container\">\n      <el-button\n          type=\"primary\"\n          @click=\"handleAdd()\">新增asin\n      </el-button>\n    </div>\n    <el-table\n        v-loading=\"asinTableLoading\"\n        :data=\"asinList\"\n        style=\"width: 100%\">\n      <el-table-column\n          prop=\"asin\"\n          label=\"asin\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          prop=\"count\"\n          label=\"关键词个数\"\n          width=\"180\">\n      </el-table-column>\n      <el-table-column\n          label=\"关键词\"\n          width=\"280\">\n        <template slot-scope=\"scope\">\n          <div slot=\"reference\" class=\"keyword-wrapper\">\n            <el-tag size=\"medium\" v-for=\"(item, index) in scope.row.keywords\" style=\"margin-right: 3px; cursor: pointer\"\n                    :key=\"item.keyword\"\n                    @click=\"handleKeywordRanking(scope.$index, index)\"\n                    >{{ item.keyword }}{{item.ranking.length > 0? ':' + item.ranking[item.ranking.length - 1].page + '-' + item.ranking[item.ranking.length - 1].index: ''}}</el-tag>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button\n              size=\"mini\"\n              @click=\"handleEdit(scope.$index, scope.row)\">编辑\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-dialog\n        title=\"提示\"\n        :visible.sync=\"asinDialogVisible\"\n        width=\"80%\">\n      <el-form :model=\"asinDetailForm\" ref=\"asinDetailForm\" label-width=\"100px\" class=\"demo-dynamic\">\n        <el-form-item\n            prop=\"asin\"\n            label=\"asin\"\n            :rules=\"{\n              required: true, message: 'asin不能为空', trigger: 'blur'\n            }\"\n        >\n          <el-input v-model=\"asinDetailForm.asin\" :disabled=\"selectEditAsinIndex !== undefined\"></el-input>\n        </el-form-item>\n        <el-form-item\n            v-for=\"(keyword, index) in asinDetailForm.keywords\"\n            :label=\"'关键词' + (index + 1)\"\n            :key=\"index\"\n            :rules=\"{\n              required: true, message: '关键词不能为空', trigger: 'blur'\n            }\"\n        >\n          <el-input v-model=\"keyword.keyword\"></el-input>\n          <el-button @click.prevent=\"removeKeyword(index)\">删除</el-button>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitAsinForm('asinDetailForm')\">提交</el-button>\n          <el-button @click=\"addKeyword\">新增keyword</el-button>\n        </el-form-item>\n      </el-form>\n      <span slot=\"footer\" class=\"dialog-footer\" v-if=\"selectEditAsinIndex !== undefined\">\n        <el-button type=\"danger\" @click=\"handleDeleteAsin\">删除此 Asin</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport {defaultItemLimit, geo} from \"@/constant\";\nimport AmazonScraper from \"@/Amazon\";\n\nexport default {\n  name: 'Home',\n  props: {\n    msg: String\n  },\n  data() {\n    return {\n      asinList: [],\n      asinTableLoading: false,\n      asinDialogVisible: false,\n      asinDetailForm: {\n        asin: '',\n        keywords: []\n      },\n      INIT_OPTIONS: {\n        bulk: true,\n        number: defaultItemLimit,\n        filetype: '',\n        rating: [1, 5],\n        page: 1,\n        cookie: '',\n        asyncTasks: 10,\n        sponsored: false,\n        category: 'aps',\n        cli: false,\n        sort: false,\n        discount: false,\n        reviewFilter: {\n          // Sort by recent/top reviews\n          sortBy: 'recent',\n          // Show only reviews with verified purchase\n          verifiedPurchaseOnly: false,\n          // Show only reviews with specific rating or positive/critical\n          filterByStar: '',\n          formatType: 'all_formats',\n        },\n      },\n      selectEditAsinIndex: undefined,\n      selectEditAsin: undefined\n    }\n  },\n  created() {\n    this.getAsinFromDb()\n    this.startTask()\n  },\n  mounted() {\n    setInterval(this.getAsinFromDb, 1000* 60)\n\n  },\n  methods: {\n    handleView(index, row) {\n      this.$router.push({\n        path: 'keyword',\n        query: {asinIndex: index}\n      })\n    },\n    handleAdd() {\n      this.asinDetailForm = {\n        asin: '',\n        keywords: []\n      }\n      this.selectEditAsinIndex = undefined\n      this.asinDialogVisible = true\n    },\n    async handleDeleteAsin() {\n      // await this.$dbOperation.dbOperation('delete',{}, this.dbKeyList[this.selectEditAsinIndex])\n\n      this.$confirm('此操作将永久删除历史, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then( async () => {\n        await this.$dbOperation.dbOperation('delete', {}, this.dbKeyList[this.selectEditAsinIndex])\n        this.$message({\n          type: 'success',\n          message: '删除成功!'\n        });\n        this.asinDialogVisible = false\n        this.resetAsinForm('asinDetailForm')\n        await this.getAsinFromDb()\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    removeKeyword(index) {\n      this.asinDetailForm.keywords.splice(index,1)\n    },\n    submitAsinForm(formName) {\n      this.$refs[formName].validate(async (valid) => {\n        if (valid) {\n          if (this.selectEditAsinIndex !== undefined) {\n            // edit\n            let keywords = []\n            // keep the old data\n            this.selectEditAsin.keywords.forEach(selectedItem => {\n              if (this.asinDetailForm.keywords.findIndex(item => { return item.keyword === selectedItem.keyword}) > -1) {\n                keywords.push(selectedItem)\n              }\n            })\n            // add new keyword\n            this.asinDetailForm.keywords.forEach(formItem => {\n              if (keywords.findIndex(item => {return item.keyword === formItem.keyword}) === -1) {\n                keywords.push({\n                  keyword: formItem.keyword,\n                  ranking: []\n                })\n              }\n            })\n            const data = {\n              asin: this.asinDetailForm.asin,\n              keywords\n            }\n            await this.$dbOperation.dbOperation('put', data, this.dbKeyList[this.selectEditAsinIndex])\n            this.$message.success('修改成功！')\n            this.resetAsinForm('asinDetailForm')\n            this.selectEditAsinIndex = undefined\n          } else {\n            // new\n            const data = {\n              asin: this.asinDetailForm.asin,\n              keywords: this.asinDetailForm.keywords.map(item => {\n                return {\n                  keyword: item.keyword,\n                  ranking: []\n                }\n              })\n            }\n            await this.$dbOperation.dbOperation('add', data)\n            this.$message.success('添加成功！')\n            this.resetAsinForm('asinDetailForm')\n          }\n          this.asinDialogVisible = false\n          await this.getAsinFromDb()\n        } else {\n          this.$message.error('填写内容有错误！')\n          return false;\n        }\n      });\n    },\n    addKeyword() {\n      this.asinDetailForm.keywords.push({\n        keyword: '',\n        ranking: []\n      })\n    },\n    resetAsinForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    handleKeywordRanking(asinIndex, keywordIndex) {\n      this.$router.push({\n        path: 'keyword',\n        query: {asinIndex, keywordIndex}\n      })\n    },\n    handleEdit(index, row) {\n      this.asinDialogVisible = true\n      this.selectEditAsin = row\n      this.asinDetailForm = row\n      this.selectEditAsinIndex = index\n    },\n//********************************************************\n    async getAsinFromDb() {\n      this.dbDataList = await this.$dbOperation.dbOperation('getAll')\n      this.dbKeyList = await this.$dbOperation.dbOperation('getAllKeys')\n      this.asinList = this.dbDataList.map(item => {\n        return {\n          asin: item.asin,\n          count: item.keywords.length,\n          keywords: item.keywords\n        }\n      })\n    },\n    async startTask() {\n\n      // start the task\n      setInterval(this.listLoop, 1000* 60 * 1)\n    },\n    async listLoop() {\n      this.dbDataList = await this.$dbOperation.dbOperation('getAll')\n      this.dbKeyList = await this.$dbOperation.dbOperation('getAllKeys')\n      for(let i = 0;i < this.dbDataList.length;i++) {\n        const asin = this.dbDataList[i]\n        let keywordList = this.dbDataList[i].keywords\n        for(let j = 0;j < keywordList.length;j++) {\n          await this.checkRanking(asin, i, j)\n        }\n      }\n    },\n    async checkRanking(asin, i, j) {\n      let options = {... this.INIT_OPTIONS}\n      options.geo = geo['US'];\n      options.scrapeType = 'ranking';\n\n      // options.filetype = 'csv'\n      options.asyncPage = 5\n      options.bulk = true\n      options.asin = asin.asin\n      options.keyword = asin.keywords[j].keyword\n      const scraper = await new AmazonScraper(options);\n      let data = await scraper.startScraper()\n      const that = this\n      setTimeout(function () {\n        that.$nextTick(async () => {\n          // update the record\n          if (data.result.length > 0) {\n            let newRanking = data.result.map(item => {\n              return {\n                page: item.page,\n                index: item.index,\n                type: item.isAd ? 'ad' : 'normal',\n                time: Number((new Date().getTime() / 1000).toFixed(0))\n              }\n            })\n            asin.keywords[j].ranking.push(...newRanking)\n            await that.$dbOperation.dbOperation('put', asin, that.dbKeyList[i])\n          }\n        })\n      }, 1000)\n    }\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\" scoped>\n.asin-container {\n  padding: 20px;\n\n  .header-container {\n    display: flex;\n    flex-direction: row-reverse;\n  }\n\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=1c3bfcec&scoped=true&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&id=1c3bfcec&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1c3bfcec\",\n  null\n  \n)\n\nexport default component.exports","'use strict';\nvar $ = require('../internals/export');\nvar global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\n\nvar TypeError = global.TypeError;\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.es/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = lengthOfArrayLike(O);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toIntegerOrInfinity(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=1c3bfcec&lang=scss&scoped=true&\"","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.es/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n"],"sourceRoot":""}